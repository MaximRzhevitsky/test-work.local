class s{constructor(s){return this._selector=s,this._isValidSelector(this._selector)||console.error("Invalid Selector",s),this._doneOnceInit=!1,this._doneOnceAlways=!1,this._doneOnceShow=!1,this._doneOnceHide=!1,this._doneFirstAlways=[],this._doneFirstShow=[],this._doneFirstHide=[],this._observers={},this._margin={top:250,bottom:250},this._observer=null,this._elements=[],this._stoped=!1,this._dependencyFunction=null,this._dependencyStatus="ready",this._dependencyMissedCallbacks=[],this._dependencyMissedAddElements=[],this._autoStop={onceInit:null,onceShow:null,onceAlways:null,onceHide:null},this._autoUnobserve={firstInit:null,firstShow:null,firstAlways:null,firstHide:null},this._callbacks={onceInit:null,onceShow:null,onceAlways:null,onceHide:null,init:null,firstShow:null,show:null,firstAlways:null,always:null,firstHide:null,hide:null},this.__callbacks={init:null,firstShow:null,show:null,firstAlways:null,always:null,firstHide:null,hide:null},this}onceInit(s,e=!0){return this._callbacks.onceInit=s,this._autoStop.onceInit=e,this.start(),this}onceShow(s,e=!0){return this._callbacks.onceShow=s,this._autoStop.onceShow=e,this.start(),this}onceAlways(s,e=!0){return this._callbacks.onceAlways=s,this._autoStop.onceAlways=e,this.start(),this}onceHide(s,e=!0){return this._callbacks.onceHide=s,this._autoStop.onceHide=e,this.start(),this}init(s,e=!1,t=!0){return this._callbacks.init=s,this._autoUnobserve.firstInit=e,!0===t&&this.start(),this}firstShow(s,e=!1,t=!0){return this._callbacks.firstShow=s,this._autoUnobserve.firstShow=e,!0===t&&this.start(),this}show(s){return this._callbacks.show=s,this}firstHide(s,e=!1,t=!0){return this._callbacks.firstHide=s,this._autoUnobserve.firstHide=e,!1===t&&this.start(),this}hide(s){return this._callbacks.hide=s,this}firstAlways(s,e=!1,t=!0){return this._callbacks.firstAlways=s,this._autoUnobserve.firstAlways=e,!1===t&&this.start(),this}always(s){return this._callbacks.always=s,this}dependency(s){return this._dependencyFunction=s,this._dependencyStatus="not_ready",this}setMargin(s=250,e=250){return this._margin.top=s,this._margin.bottom=e,this}addElement(s){return this._elements.includes(s)||(this._elements.push(s),void 0===s.liveBlock&&(s.liveBlock={}),void 0===s.liveBlock[this._selector]&&(s.liveBlock[this._selector]=[]),s.liveBlock[this._selector].push(this),this._initElement(s),!1===this._stoped&&("undefined"==typeof IntersectionObserver?this._badBrowsers(s):this._goodBrowsers(s))),this}_badBrowsers(s){const e=()=>{this._dependencyStatus="ready",this._badBrowsers(s)},t=e=>{this._observers[s].unobserve(s),e&&console.error(e)};"ready"===this._dependencyStatus?Object.keys(this._callbacks).forEach((e=>{this.__callbacks[e]&&this._callbacks[e].bind(s)(),this._callbacks[e]&&this._callbacks[e].bind(s)()})):"not_ready"===this._dependencyStatus&&(this._dependencyStatus="process",this._dependencyFunction(e,t))}_goodBrowsers(s){let e=!1;this._observers[s]=new IntersectionObserver((([t])=>{e||t.intersectionRatio>0?(e=!0,t.isIntersecting?this._runElement(s,"show"):!1===t.isIntersecting&&this._runElement(s,"hide"),this._runElement(s,"always")):e=!0}),{rootMargin:`${this._margin.bottom}px 0px ${this._margin.top}px 0px`,threshold:[.01]}),this._observers[s].observe(s)}_initElement(s){if(this&&(this._callbacks.init||this.__callbacks.init||this._callbacks.onceInit)){const e=()=>{this._dependencyStatus="ready",this._dependencyMissedAddElements.forEach(this._initElement),this._dependencyMissedAddElements=[]},t=e=>{this._observers[s].unobserve(s),e&&console.error(e)};if("ready"===this._dependencyStatus){if(this._callbacks.onceInit)return void(!1===this._doneOnceInit&&(this._doneOnceInit=!0,this._callbacks.onceInit.bind(s)(),this._autoStop.onceInit&&this.stop()));this.__callbacks.init&&this.__callbacks.init.bind(s)(),this._callbacks.init&&this._callbacks.init.bind(s)()}else"not_ready"===this._dependencyStatus?(this._dependencyStatus="process",this._dependencyMissedAddElements.push(s),this._dependencyFunction(e,t)):"process"===this._dependencyStatus&&this._dependencyMissedAddElements.push(s)}}_runElement(s,e){if("ready"===this._dependencyStatus){const t=e.charAt(0).toUpperCase()+e.slice(1);this._callbacks[`once${t}`]&&!1===this[`_once${t}`]&&(this[`_once${t}`]=!0,this._callbacks[`once${t}`].bind(s)(),this._autoStop[`once${t}`]&&this.stop()),this[`_doneFirst${t}`].includes(s)||(this[`_doneFirst${t}`].push(s),this.__callbacks[`first${t}`]&&this.__callbacks[`first${t}`].bind(s)(),this._callbacks[`first${t}`]&&(this._callbacks[`first${t}`].bind(s)(),this._autoUnobserve[`first${t}`]&&this._observers[s].unobserve(s))),this.__callbacks[e]&&this.__callbacks[e].bind(s)(),this._callbacks[e]&&this._callbacks[e].bind(s)()}else if("not_ready"===this._dependencyStatus){const t=()=>{this._dependencyStatus="ready",this._dependencyMissedCallbacks.forEach((({element:s,type:e})=>{this._runElement(s,e)})),this._dependencyMissedCallbacks=[]},i=e=>{this._observers[s].unobserve(s),e&&console.error(e)};this._dependencyStatus="process",this._dependencyMissedCallbacks.push({type:e,element:s}),this._dependencyFunction(t,i)}else"process"===this._dependencyStatus&&this._dependencyMissedCallbacks.push({type:e,element:s})}start(){if(null===this._observer&&this._isValidSelector(this._selector)){this._observer=new MutationObserver((s=>{s.forEach((s=>{"childList"===s.type&&s.addedNodes.length&&s.addedNodes.forEach((s=>{s instanceof HTMLElement&&(s.matches(this._selector)&&this.addElement(s),s.querySelectorAll(this._selector).forEach((s=>{this.addElement(s)})))}))}))}));const s=()=>{document.body?(this._observer.observe(document.body,{subtree:!0,childList:!0}),document.querySelectorAll(this._selector).forEach((s=>this.addElement(s)))):window.setTimeout(s,50)};s()}return this}stop(){this._stoped=!0,this._observer.disconnect(),this._elements.forEach((s=>{void 0!==this._observers[s]&&this._observers[s].unobserve(s)}))}_isValidSelector(s){try{document.createDocumentFragment().querySelector(s)}catch(s){return!1}return!0}}export{s as LiveDom};export default function e(e){return new s(e)}